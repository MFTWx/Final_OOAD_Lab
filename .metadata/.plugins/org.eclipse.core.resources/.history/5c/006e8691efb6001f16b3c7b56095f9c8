package controller;

import java.util.ArrayList;

import model.User;

public class UserController {
	
	private static UserController uc = null;
	private User userModel;
	
	ArrayList<User> allUser;
	
	private UserController() {
		userModel = new User();
		allUser = new ArrayList<User>();
		allUser = userModel.getAllUser();
	}
	
	public static UserController getInstance() {
		if(uc == null) {
			uc = new UserController();
		}
		return uc;
	}
	
	public boolean Login(String Username, String Password) {
		
		for(User user : allUser) {
			if(user.getUsername().equals(Username) && user.getPassword().equals(Password)) {
				System.out.println("Login successful");
			}
		}
		System.out.println("Login failed");
		return false;
	}
	
	public void Register(String Username, String Password, String Phone_number, String Address, String Role) {
		
		boolean validated = CheckAccountValidation(Username, Password, Phone_number, Address);
		
		if(validated) {
			String id = "id_" + System.currentTimeMillis();
						
			boolean result = userModel.createUser(id, Username, Password, Phone_number, Address, Role);
			if (result) {
			    System.out.println("User created successfully!");
			} else {
			    System.out.println("Failed to create user.");
			}
		} else {
			System.out.println("Failed validations");
		}
	}
	
	public boolean CheckAccountValidation(String Username, String Password, String Phone_number, String Address) {
		
		ArrayList<String> usernames = new ArrayList<String>();
		
		for(User user : allUser) {
			usernames.add(user.getUsername());
		}
		
		if(Username.isEmpty() || Username.length() < 3) {
			return false;
		} else if(Password.isEmpty() || Password.length() < 8 || !Password.matches(".*[!@#$%^&*].*") ) {
			return false;
		} else if(Phone_number.isEmpty() || !Phone_number.startsWith("+62") || Phone_number.length() != 12) {
	        return false;
	    } else if(Address.isEmpty()) {
			return false;
		} else {
			for(String username : usernames) {
				if(Username.equals(username)) {
					return false;
				}
			}
			return true;
		}
	}
	
}
